#!/usr/bin/env fish

set url "https://raw.githubusercontent.com/StevenBlack/hosts/master/alternates/fakenews-gambling-social/hosts"

echo -e "ðŸº upgrading brew bundle (formulae, casks, mas)\n\n"
brew bundle upgrade --file ~/dotfiles/homebrew/Brewfile

echo -e "\n\nðŸ upgrading uv tools\n\n"
uv tool upgrade --all

echo -e "\n\nðŸ“¦ upgrading bun's global packages\n\n"
bun update --global

echo -e "\n\nðŸ“¡ upgrading gh extensions\n\n"
gh extension upgrade --all

echo -e "\n\nðŸ›œ downloading new hosts file"
sudopass curl $url --output /etc/hosts --silent

echo -e "\nðŸ¤ž attempting to whitelist:"
cat $HOME/dotfiles/.hosts_patterns | while read line
    echo -e "  â­ï¸ $(string replace ".*\\s" "" -- $line)"
end
touch /tmp/hosts
rg -vox -f $HOME/dotfiles/.hosts_patterns /etc/hosts | tee /tmp/hosts >/dev/null
sudo mv /tmp/hosts /etc/hosts
