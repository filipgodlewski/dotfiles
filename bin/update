#!/usr/bin/env fish

set url "https://raw.githubusercontent.com/StevenBlack/hosts/master/alternates/fakenews-gambling-social/hosts"

echo -e "\nðŸº upgrading brew bundle (formulae, casks, mas)"
brew bundle upgrade --global --quiet

echo -e "\nðŸ“¦ upgrading npm's global packages"
npm update --global

echo -e "\nðŸ’¤ upgrading LazyVim packages"
nvim --headless '+Lazy! check' +qa | tee | rg -e '\[([\w\-\.]+)\] checkout \| HEAD.*' --replace '  ðŸŽ‰ Updated $1'

# echo -e "\nðŸ› ï¸ upgrading Mason packages"
# nvim --headless '+autocmd User MasonUpdateAllComplete quitall' +MasonUpdateAll

echo -e "\nðŸ›œ downloading new hosts file"
sudopass curl $url --output /etc/hosts --silent

echo -e "\nðŸ¤ž attempting to whitelist:"
cat $HOME/dotfiles/.hosts_patterns | while read line
    echo -e "  â­ï¸ $(string replace ".*\\s" "" -- $line)"
end
touch /tmp/hosts
rg -vox -f $HOME/dotfiles/.hosts_patterns /etc/hosts | tee /tmp/hosts >/dev/null
sudo mv /tmp/hosts /etc/hosts
