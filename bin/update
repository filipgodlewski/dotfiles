#!/usr/bin/env fish

set url "https://raw.githubusercontent.com/StevenBlack/hosts/master/alternates/fakenews-gambling-social/hosts"

echo -e "🍺 upgrading brew bundle (formulae, casks, mas)\n\n"
brew bundle upgrade --file ~/dotfiles/homebrew/Brewfile

echo -e "\n\n🐍 upgrading uv tools\n\n"
uv tool upgrade --all

echo -e "\n\n📦 upgrading bun's global packages\n\n"
bun update --global

echo -e "\n\n📡 upgrading gh extensions\n\n"
gh extension upgrade --all

echo -e "\n\n🛜 downloading new hosts file"
sudopass curl $url --output /etc/hosts --silent

echo -e "\n🤞 attempting to whitelist:"
cat $HOME/dotfiles/.hosts_patterns | while read line
    echo -e "  ⭐️ $(string replace ".*\\s" "" -- $line)"
end
touch /tmp/hosts
rg -vox -f $HOME/dotfiles/.hosts_patterns /etc/hosts | tee /tmp/hosts >/dev/null
sudo mv /tmp/hosts /etc/hosts
